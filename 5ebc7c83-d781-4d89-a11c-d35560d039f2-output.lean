/-
This file was generated by Aristotle.

Lean version: leanprover/lean4:v4.24.0
Mathlib version: f897ebcf72cd16f89ab4577d0c826cd14afaafc7
This project request had uuid: 5ebc7c83-d781-4d89-a11c-d35560d039f2
-/

/-
We define the constants and functions as requested. We prove that `c_arch_K1 < 0`, contrary to the user's claim that `c_arch_K1 > 0.1878`. The discrepancy likely arises from the evaluation of the term `M_B / (4 * Real.pi^2 * t * r)`, which is approximately 74 with the given parameters, whereas the user's sketch claims it is approximately 0.007. We formally prove the negation of the main theorem in `a3_k1_floor_false`.
-/

import Mathlib

set_option linter.mathlibStandardSet false

open scoped BigOperators
open scoped Real
open scoped Nat
open scoped Classical
open scoped Pointwise

set_option maxHeartbeats 0
set_option maxRecDepth 4000
set_option synthInstance.maxHeartbeats 20000
set_option synthInstance.maxSize 128

set_option relaxedAutoImplicit false
set_option autoImplicit false

noncomputable section

noncomputable def B_K1 : ℝ := 1/3
noncomputable def r_K1 : ℝ := 1/32
noncomputable def t_sym_K1 : ℝ := 3/50

noncomputable def a_zero : ℝ := Real.log Real.pi + Real.eulerMascheroniConstant + Real.pi/2 + 3 * Real.log 2

noncomputable def m_r_lower (r : ℝ) : ℝ := a_zero - 20 * Real.pi * r

noncomputable def M_B_upper : ℝ := 11/2

noncomputable def L_A_upper (B t : ℝ) : ℝ := M_B_upper / (4 * Real.pi^2 * t) + 10 / (4 * Real.pi^2 * t)^(3/2)

#check Real.exp

noncomputable def core_lower (B r t m_r M_B : ℝ) : ℝ :=
  2 * m_r * r * (1 - r/B) * Real.exp (-4 * Real.pi^2 * t * r^2) -
  M_B / (4 * Real.pi^2 * t * r) * Real.exp (-4 * Real.pi^2 * t * r^2)

noncomputable def c_arch_K1 : ℝ :=
  core_lower B_K1 r_K1 t_sym_K1 (m_r_lower r_K1) M_B_upper - Real.pi * L_A_upper B_K1 t_sym_K1

lemma a_zero_bound : a_zero ≥ 5117/1000 := by
  unfold a_zero;
  -- First, we note that $\pi \approx 3.14159$ and $\ln(2) \approx 0.693147$.
  have h_approx : Real.pi > 3.1415 ∧ Real.log 2 > 0.6931 := by
    exact ⟨ Real.pi_gt_d4, Real.log_two_gt_d9.trans_le' <| by norm_num ⟩;
  -- Next, we use the fact that $\gamma \approx 0.5772$.
  have h_gamma : Real.eulerMascheroniConstant > 0.5 := by
    -- We'll use the fact that the Euler-Mascheroni constant is greater than 0.5.
    have h_euler : Real.eulerMascheroniConstant > 1 / 2 := by
      exact?;
    exact lt_of_le_of_lt ( by norm_num ) h_euler;
  linarith [ Real.log_exp 1, Real.log_le_log ( by positivity ) ( show Real.pi ≥ Real.exp 1 by exact Real.exp_one_lt_d9.le.trans ( by norm_num; linarith [ Real.pi_gt_three ] ) ) ]

lemma L_A_bound : L_A_upper B_K1 t_sym_K1 ≥ 4 := by
  unfold L_A_upper;
  -- Substitute the values of `M_B_upper` and `t_sym_K1` into the expression.
  norm_num [M_B_upper, t_sym_K1];
  rw [ ← add_div, le_div_iff₀ ] <;> nlinarith [ Real.pi_gt_three, Real.pi_le_four ]

lemma m_r_bound : m_r_lower r_K1 ≥ 315/100 := by
  unfold m_r_lower;
  -- Since $\pi < 3.1416$, we have $5/8 \pi < 5/8 \times 3.1416 = 1.9635$.
  have h_pi_bound : Real.pi < 3.1416 := by
    exact?;
  -- Substitute the value of `r_K1` and simplify.
  have h_r_K1 : r_K1 = 1 / 32 := by
    exact?;
  norm_num1 at *; nlinarith [ a_zero_bound ] ;

lemma exp_term_bound : Real.exp (-4 * Real.pi^2 * t_sym_K1 * r_K1^2) ≥ 997/1000 := by
  field_simp;
  -- We'll use that $Real.pi < 3.1416$ to estimate the exponent.
  have h_pi : Real.pi < 3.1416 := by
    exact?;
  exact le_trans ( by norm_num ) ( mul_le_mul_of_nonneg_left ( Real.add_one_le_exp _ ) ( by norm_num ) ) |> le_trans <| mul_le_mul_of_nonneg_left ( Real.exp_le_exp.2 <| show - ( 4 * Real.pi ^ 2 * ( 3 / 50 ) * ( 1 / 32 ) ^ 2 ) ≥ -0.0024 by norm_num1 at *; nlinarith [ Real.pi_gt_three ] ) ( by norm_num )

theorem a3_k1_floor_neg : c_arch_K1 < 0 := by
  -- Now use the fact that each term is bounded to show the sum is less than zero.
  have h_sum_bound : 2 * m_r_lower r_K1 * r_K1 * (1 - r_K1 / B_K1) * Real.exp (-4 * Real.pi^2 * t_sym_K1 * r_K1^2) < 1 := by
    refine' lt_of_le_of_lt ( mul_le_mul_of_nonneg_left ( Real.exp_le_one_iff.mpr _ ) _ ) _ <;> norm_num [ Real.pi_pos.le ];
    · exact mul_nonneg ( mul_nonneg ( mul_nonneg zero_le_four ( sq_nonneg _ ) ) ( show 0 ≤ t_sym_K1 by exact div_nonneg ( by norm_num ) ( by norm_num ) ) ) ( sq_nonneg _ );
    · unfold m_r_lower B_K1 r_K1; norm_num;
      refine' le_trans _ a_zero_bound;
      -- We'll use that π is approximately 3.14 to estimate the value.
      have h_pi : Real.pi < 3.15 := by
        exact?;
      norm_num at h_pi ; linarith;
    · rw [ show m_r_lower r_K1 = a_zero - 20 * Real.pi * r_K1 by rfl ] ; ring_nf;
      unfold a_zero r_K1 B_K1;
      -- We'll use the fact that $\gamma \approx 0.577$ and $\pi \approx 3.14$ to simplify the expression.
      have h_approx : Real.eulerMascheroniConstant < 1 ∧ Real.pi < 3.15 ∧ Real.log Real.pi < 1.2 ∧ Real.log 2 < 0.7 := by
        aesop;
        · -- By definition of Euler-Mascheroni constant, we know that $\gamma = \lim_{n \to \infty} (H_n - \ln n)$.
          have h_gamma_def : Filter.Tendsto (fun n => (∑ k ∈ Finset.range n, (1 : ℝ) / (k + 1)) - Real.log n) Filter.atTop (nhds Real.eulerMascheroniConstant) := by
            convert Real.tendsto_harmonic_sub_log;
            norm_num [ harmonic ];
          -- Since $H_n - \ln n$ is decreasing and converges to $\gamma$, we have $H_n - \ln n \geq \gamma$ for all $n$.
          have h_gamma_le : ∀ n : ℕ, n ≥ 1 → (∑ k ∈ Finset.range n, (1 : ℝ) / (k + 1)) - Real.log n ≥ Real.eulerMascheroniConstant := by
            have h_gamma_le : ∀ n : ℕ, n ≥ 1 → (∑ k ∈ Finset.range n, (1 : ℝ) / (k + 1)) - Real.log n ≥ (∑ k ∈ Finset.range (n + 1), (1 : ℝ) / (k + 1)) - Real.log (n + 1) := by
              norm_num [ Finset.sum_range_succ ];
              intro n hn; rw [ show ( n : ℝ ) + 1 = n * ( 1 + ( n : ℝ ) ⁻¹ ) by nlinarith only [ mul_inv_cancel₀ ( by positivity : ( n : ℝ ) ≠ 0 ) ], Real.log_mul ( by positivity ) ( by positivity ) ] ; ring_nf;
              exact add_le_add_left ( by rw [ inv_eq_one_div, div_le_iff₀ ] <;> nlinarith only [ Real.log_inv ( 1 + ( n : ℝ ) ⁻¹ ), Real.log_le_sub_one_of_pos ( inv_pos.mpr ( by positivity : 0 < ( 1 + ( n : ℝ ) ⁻¹ ) ) ), Real.log_le_sub_one_of_pos ( by positivity : 0 < ( 1 + ( n : ℝ ) ⁻¹ ) ), mul_inv_cancel₀ ( by positivity : ( 1 + ( n : ℝ ) ⁻¹ ) ≠ 0 ), mul_inv_cancel₀ ( by positivity : ( n : ℝ ) ≠ 0 ) ] ) _;
            intro n hn; exact le_of_tendsto h_gamma_def ( Filter.eventually_atTop.mpr ⟨ n, fun m hm => by induction hm <;> aesop ; linarith [ h_gamma_le _ <| by linarith ] ⟩ ) ;
          exact lt_of_le_of_lt ( h_gamma_le 4 ( by norm_num ) ) ( by norm_num; have := Real.log_two_gt_d9; norm_num1 at *; rw [ show ( 4 : ℝ ) = 2 ^ 2 by norm_num, Real.log_pow ] ; norm_num at *; linarith [ Real.log_lt_sub_one_of_pos zero_lt_two ( by norm_num ) ] );
        · exact?;
        · rw [ Real.log_lt_iff_lt_exp ] <;> norm_num;
          · -- We'll use that π is approximately 3.14 to estimate the value.
            have h_pi_approx : Real.pi < 3.15 := by
              exact?;
            exact h_pi_approx.trans_le <| by have := Real.exp_one_gt_d9.le; norm_num1 at *; rw [ show ( 6 : ℝ ) / 5 = 1 + 1 / 5 by norm_num, Real.exp_add ] ; nlinarith [ Real.add_one_le_exp ( 1 / 5 ) ] ;
          · positivity;
        · exact Real.log_two_lt_d9.trans_le <| by norm_num;
      norm_num at h_approx ; linarith [ Real.pi_gt_three ];
  -- Now use the fact that $L_A_upper B_K1 t_sym_K1 \geq 4$ to bound the negative term.
  have h_term2_bound : M_B_upper / (4 * Real.pi^2 * t_sym_K1 * r_K1) * Real.exp (-4 * Real.pi^2 * t_sym_K1 * r_K1^2) > 50 := by
    -- Substitute the known values into the term.
    have h_term2_val : M_B_upper / (4 * Real.pi^2 * t_sym_K1 * r_K1) > 50 / (997 / 1000) := by
      -- Substitute the known values into the term and simplify.
      have h_term2_val : M_B_upper / (4 * Real.pi^2 * t_sym_K1 * r_K1) = (11 / 2) / (3 * Real.pi^2 / 400) := by
        unfold M_B_upper t_sym_K1 r_K1; ring;
      -- We'll use that π is approximately 3.14 to estimate the value.
      have h_pi_approx : Real.pi < 3.15 := by
        exact?;
      rw [ h_term2_val, gt_iff_lt, div_lt_div_iff₀ ] <;> norm_num at * <;> nlinarith [ Real.pi_gt_three ];
    -- Since $e^{-4\pi^2 t r^2} \geq 0.997$, we have $M_B_upper / (4 * \pi^2 * t_sym_K1 * r_K1) * e^{-4\pi^2 t r^2} \geq M_B_upper / (4 * \pi^2 * t_sym_K1 * r_K1) * 0.997$.
    have h_term2_exp_bound : M_B_upper / (4 * Real.pi^2 * t_sym_K1 * r_K1) * Real.exp (-4 * Real.pi^2 * t_sym_K1 * r_K1^2) ≥ M_B_upper / (4 * Real.pi^2 * t_sym_K1 * r_K1) * (997 / 1000) := by
      exact mul_le_mul_of_nonneg_left ( by linarith [ exp_term_bound ] ) ( by linarith );
    linarith;
  -- Now use the fact that $Real.pi * L_A_upper B_K1 t_sym_K1 \geq 12$ to bound the negative term.
  have h_term3_bound : Real.pi * L_A_upper B_K1 t_sym_K1 ≥ 12 := by
    have h_term3_bound : Real.pi * L_A_upper B_K1 t_sym_K1 ≥ Real.pi * 4 := by
      exact mul_le_mul_of_nonneg_left ( L_A_bound ) Real.pi_pos.le;
    exact le_trans ( by linarith only [ Real.pi_gt_three ] ) h_term3_bound;
  unfold c_arch_K1;
  unfold core_lower; linarith;

theorem a3_k1_floor_false : ¬ (c_arch_K1 ≥ 1346209 / 7168000) := by
  have h := a3_k1_floor_neg
  linarith
/-
This file was generated by Aristotle.

Lean version: leanprover/lean4:v4.24.0
Mathlib version: f897ebcf72cd16f89ab4577d0c826cd14afaafc7
This project request had uuid: 23659b1b-c03a-4348-ae09-2891edeee00b
-/

/-
Formalized and proved the commutator sum bound theorems for Vector 3 Task #2.
Key results:
- `comm_add`: Commutator is additive in the first argument.
- `comm_sum`: Commutator distributes over finite sums.
- `opNorm_sum_le`: Triangle inequality for operator norms of finite sums.
- `comm_sum_bound`: The norm of the commutator of a sum is bounded by the sum of the norms of the commutators.

These results provide the necessary linearity and triangle inequality bounds for the Spectral/Q3 attack on Twin Primes.
-/

import Mathlib

set_option linter.mathlibStandardSet false

open scoped BigOperators
open scoped Real
open scoped Nat
open scoped Classical
open scoped Pointwise

set_option maxHeartbeats 0
set_option maxRecDepth 4000
set_option synthInstance.maxHeartbeats 20000
set_option synthInstance.maxSize 128

set_option relaxedAutoImplicit false
set_option autoImplicit false

noncomputable section

open scoped ComplexConjugate
open Complex

#check comm

variable {H : Type} [NormedAddCommGroup H] [InnerProductSpace ℂ H] [CompleteSpace H]
variable {ι : Type} [DecidableEq ι]

/-- Commutator of bounded operators -/
def Vector3Task2.comm (A U : H →L[ℂ] H) : H →L[ℂ] H :=
  A.comp U - U.comp A

lemma comm_add (A₁ A₂ U : H →L[ℂ] H) :
    Vector3Task2.comm (A₁ + A₂) U = Vector3Task2.comm A₁ U + Vector3Task2.comm A₂ U := by
      -- By definition of commutator, we have:
      simp [Vector3Task2.comm];
      grind

open scoped BigOperators

/-- Commutator distributes over finite sums -/
lemma comm_sum (U : H →L[ℂ] H) (s : Finset ι) (Ai : ι → (H →L[ℂ] H)) :
    Vector3Task2.comm (Finset.sum s (fun i => Ai i)) U = Finset.sum s (fun i => Vector3Task2.comm (Ai i) U) := by
  classical
  induction s using Finset.induction_on with
  | empty =>
    simp only [Finset.sum_empty, Vector3Task2.comm]
    ext x
    simp
  | insert a s ha ih =>
    rw [Finset.sum_insert ha, comm_add, ih, Finset.sum_insert ha]

/-- Triangle inequality for operator norms of finite sums -/
lemma opNorm_sum_le (s : Finset ι) (Ti : ι → (H →L[ℂ] H)) :
    ‖Finset.sum s (fun i => Ti i)‖ ≤ Finset.sum s (fun i => ‖Ti i‖) := by
  classical
  induction s using Finset.induction_on with
  | empty => simp
  | insert a s ha ih =>
    rw [Finset.sum_insert ha, Finset.sum_insert ha]
    calc ‖Ti a + Finset.sum s (fun i => Ti i)‖
        ≤ ‖Ti a‖ + ‖Finset.sum s (fun i => Ti i)‖ := norm_add_le _ _
      _ ≤ ‖Ti a‖ + Finset.sum s (fun i => ‖Ti i‖) := by linarith

/-- MAIN THEOREM: Commutator norm of sum bounded by sum of norms -/
theorem comm_sum_bound (U : H →L[ℂ] H) (s : Finset ι) (Ai : ι → (H →L[ℂ] H)) :
    ‖Vector3Task2.comm (Finset.sum s (fun i => Ai i)) U‖ ≤ Finset.sum s (fun i => ‖Vector3Task2.comm (Ai i) U‖) := by
  rw [comm_sum U s Ai]
  exact opNorm_sum_le s (fun i => Vector3Task2.comm (Ai i) U)
# Исследование системы Aristotle: Архитектура и функциональность

## Основная информация

**Aristotle** — это AI-система для автоматического доказательства теорем на уровне IMO (International Mathematical Olympiad), разработанная компанией Harmonic.

### Ключевые достижения:
- Решила 5 из 6 задач IMO 2025 на уровне золотой медали
- Независимо решила проблему Erdős #124 (открытая 30 лет)
- Использует формальную верификацию в Lean 4 с библиотекой Mathlib

---

## Архитектура системы

Aristotle состоит из трёх основных компонентов:

### 1. **Lean Proof Search Algorithm** (Алгоритм поиска доказательств в Lean)

**Назначение:** Основной движок системы, который берёт блок кода Lean с пропусками (marked as `sorry`) и пытается заполнить все недоказанные цели.

**Технология:**
- **Monte Carlo Graph Search (MCGS)** — обобщение Monte Carlo Tree Search
- Состояния доказательства представлены как узлы в ориентированном графе
- Рёбра соответствуют применению тактик Lean (intro, cases, simp и т.д.)
- Каждое действие может создавать несколько подцелей

**Модель:**
- Большой трансформер (200B+ параметров) служит одновременно:
  - **Policy function** (политика) — предсказывает тактики Lean на основе:
    - Текущего состояния доказательства
    - Истории доказательства
    - Неформального доказательства (если доступно)
  - **Value function** (функция оценки) — оценивает вероятность успешного доказательства

**Процесс:**
1. Обработка блока Lean кода со `sorry` утверждениями
2. Генеративная политика выбирает тактики из большого пространства действий
3. Поиск параллельно исследует разные ветви доказательства
4. Lean kernel верифицирует корректность каждого шага

**Особенности:**
- Highly parallel (высоко параллелизированный)
- Использует progressively widened sampling (постепенно расширяющуюся выборку)
- Способен доказывать университетские и олимпиадные задачи самостоятельно

---

### 2. **Lemma-Based Informal Reasoning System** (Система неформального рассуждения на основе лемм)

**Назначение:** Разложить сложные задачи IMO на управляемые подзадачи через неформальное рассуждение.

**Процесс:**

#### A. Proof Narrative Elicitation (Извлечение нарратива доказательства)
- Начиная с формулировки задачи, система генерирует нарратив предполагаемого доказательства
- Разлагает доказательство на вспомогательные леммы
- Отражает подход опытного математика, решающего задачу

#### B. Auxiliary and Novel Definitions (Вспомогательные и новые определения)
- Создаёт творческие вспомогательные определения, не указанные в исходной задаче
- Пример:
  ```lean
  def S(f:N⁺→N⁺):Set N⁺:={p∣Nat.Prime(p)∧f(p)>1}
  ```
- Позволяет изолировать и формализовать ключевые структурные свойства

#### C. Autoformalization Pipeline (Конвейер автоформализации)
- Неформальные леммы на естественном языке преобразуются в утверждения Lean
- **Итеративный процесс:**
  - Lean пытается верифицировать формальное утверждение
  - Если возникают ошибки, они парсятся и передаются обратно в неформальный слой
  - Система корректирует как неформальные, так и формальные утверждения
  - Процесс повторяется до успеха

#### D. Iterative Refinement (Итеративное уточнение)
- Неудачные попытки триггерят пересмотр на обоих уровнях (неформальном и формальном)
- Особенно важно для IMO задач, требующих нескольких подходов

**Ключевая особенность:** Система может использовать неформальное рассуждение и выполнение кода для поиска ответов и черновиков доказательств, но проблема считается решённой только если система производит полное доказательство на Lean 4 без пропусков и неправильных аксиом (без `sorryAx`).

---

### 3. **Dedicated Geometry Solver (Yuclid)** (Специализированный решатель геометрии)

**Назначение:** Решение задач плоской геометрии вне Lean с последующей верификацией.

**Технология:**
- Реализация на C++ для высокой производительности
- Основана на подходе AlphaGeometry

**Процесс:**

#### A. Diagram Preprocessing (Предварительная обработка диаграмм)
- Сканирование диаграмм на стандартные конфигурации:
  - Середины отрезков
  - Биссектрисы
  - Подобные треугольники
- Использует численное сопоставление правил (numeric rule matching)

#### B. Algebraic Reasoning (Алгебраическое рассуждение)
- Конфигурации кодируются в уравнения и неравенства
- Обработка методом Гаусса (Gaussian elimination)
- Таблицы алгебраических правил
- Пример формализации перпендикулярности:
  ```
  AB ⊥ CD ⟺ AC² + BD² = AD² + BC²
  ```

#### C. Deductive Database (Дедуктивная база данных)
- Обширные таблицы правил для быстрого вывода
- Дедупликация и оптимизированные стратегии обновления
- Решает десятки геометрических задач за миллисекунды на одном ядре

#### D. Lean Integration (Интеграция с Lean)
- Выявленные конфигурации кодифицируются как вспомогательные факты в Lean
- Результаты Yuclid передаются в Lean для формальной верификации

---

## Интеграция компонентов

### Общий рабочий процесс:

1. **Входная задача** (формальная или неформальная)

2. **Неформальное рассуждение** (Lemma-Based System)
   - Разложение на леммы
   - Генерация неформального доказательства
   - Создание вспомогательных определений

3. **Автоформализация** (Informal → Formal)
   - Преобразование неформальных лемм в Lean
   - Итеративная корректировка при ошибках

4. **Формальный поиск доказательства** (Lean Proof Search)
   - MCGS с трансформер-моделью
   - Параллельное исследование ветвей
   - Верификация Lean kernel

5. **Специальная обработка геометрии** (Yuclid, если необходимо)
   - Алгебраическое решение
   - Кодификация в Lean факты

6. **Финальная верификация**
   - Полное доказательство в Lean 4
   - Без пропусков (sorry) и неправильных аксиом

---

## Ключевые технические детали

### Lean Proof Search Механизмы:

1. **MCGS Framework**
   - Состояния как вершины ориентированного графа
   - Эквивалентные классы для избежания дублирования
   - PUCT-варианты (Predictor Upper Confidence Bound applied to Trees) для приоритизации действий

2. **Transformer Model**
   - 200B+ параметров
   - Обучение через reinforcement learning expert iteration
   - Успешные пути поиска (частичные или полные) используются для переобучения
   - Действие считается успешным только если все порождённые подцели разрешены

3. **Parallelization and Test-Time Training**
   - Множественные экземпляры поиска работают параллельно
   - Каждый исследует разные разложения лемм или тактики
   - Test-time training — обучение от собственных следов поиска во время инференса
   - Адаптация выбора тактик к структуре каждой задачи

4. **Formal Verification**
   - Lean kernel как формальный гарант
   - Пропуски заполняются только если Lean верифицирует корректность

---

## Масштабируемость и производительность

### Достижения:
- IMO 2025: 5 из 6 задач (золотая медаль)
- Erdős Problem #124: решена независимо за 6 часов
- Работает на университетском и олимпиадном уровне

### Масштабирование:
- Параллелизированная генерация лемм
- Параллельный поиск тактик
- Трансформер 200B+ параметров
- Благоприятные свойства масштабирования для систем автоматического доказательства теорем

---

## Связь с другими системами

**Похожие подходы:**
- HyperTree Proof Search (HTPS)
- ABEL
- DeepSeek-Prover-V1.5
- AlphaProof (AlphaZero для доказательства теорем)

**Отличия Aristotle:**
- Комбинирует формальный поиск с неформальным рассуждением
- Специализированный решатель геометрии
- Модульная архитектура для разложения сложных задач
- Итеративная автоформализация с обратной связью

---

## Lean и Mathlib

**Lean 4** — это язык программирования и помощник доказательства, который:
- Позволяет писать машинно-верифицируемые доказательства
- Имеет библиотеку Mathlib с математическими определениями и теоремами
- Обеспечивает надёжный и быстрый сигнал вознаграждения для обучения ML систем

**Тактики Lean** — инструкции для построения доказательств:
- `intro` — введение переменной в контекст
- `cases` — разбор по случаям
- `simp` — упрощение
- `rw` — переписывание
- И многие другие

---

## Выводы

Aristotle представляет собой интегрированную систему, которая:

1. **Комбинирует сильные стороны:**
   - Формальной верификации (надёжность, машинная проверяемость)
   - Неформального рассуждения (гибкость, творчество)
   - Специализированных решателей (эффективность на подклассах)

2. **Использует передовые ML техники:**
   - Большие трансформеры (200B+ параметров)
   - Monte Carlo Graph Search
   - Reinforcement learning expert iteration
   - Test-time training

3. **Достигает человеко-конкурентной производительности:**
   - На уровне золотой медали IMO
   - Решает открытые проблемы
   - Работает на университетском уровне

4. **Обеспечивает полную верификацию:**
   - Все доказательства в Lean 4
   - Без пропусков и неправильных аксиом
   - Kernel-verified корректность

/-
This file was generated by Aristotle.

Lean version: leanprover/lean4:v4.24.0
Mathlib version: f897ebcf72cd16f89ab4577d0c826cd14afaafc7
This project request had uuid: d6f01660-e23d-4785-a374-ef8c9c63f275

Aristotle's budget for this request has been reached.
If there is partial progress, it will appear in this file.
If you would like to continue working off of this partial progress,
please submit the same prompt, and add this .lean file in "Optional: Attach a Lean file as context" field.

-/

import Mathlib

set_option linter.mathlibStandardSet false

open scoped BigOperators
open scoped Real
open scoped Nat
open scoped Classical
open scoped Pointwise

set_option maxHeartbeats 0
set_option maxRecDepth 4000
set_option synthInstance.maxHeartbeats 20000
set_option synthInstance.maxSize 128

set_option relaxedAutoImplicit false
set_option autoImplicit false

noncomputable section

/-
Definitions of e(x), S(X, α), Ψ(α), MajorArcs(X), and singularSeries.
-/
open Nat Real Complex ArithmeticFunction BigOperators Finset MeasureTheory Filter Set
open scoped ArithmeticFunction.vonMangoldt

noncomputable def e (x : ℝ) : ℂ := exp (2 * π * I * x)

noncomputable def S (X : ℝ) (α : ℝ) : ℂ :=
  ∑ n ∈ range (Nat.floor X + 1), ((ArithmeticFunction.vonMangoldt n : ℝ) : ℂ) * e (n * α)

noncomputable def Ψ (α : ℝ) : ℂ := e (2 * α)

noncomputable def MajorArcs (X : ℝ) : Set ℝ :=
  let Q := X^(1/2)
  ⋃ q ∈ {q : ℕ | 1 ≤ q ∧ (q : ℝ) ≤ Q},
    ⋃ a ∈ {a : ℕ | 1 ≤ a ∧ a ≤ q ∧ a.Coprime q},
      {α | |α - (a : ℝ) / q| < Q / (q * X)}

noncomputable def singularSeries : ℝ :=
  2 * Real.exp (∑' (p : ℕ), if p.Prime ∧ 2 < p then Real.log (1 - 1 / ((p : ℝ) - 1)^2) else 0)

/-
Definition of V(X, β) and proof that the singular series constant is positive.
-/
open Nat Real Complex ArithmeticFunction BigOperators Finset MeasureTheory Filter Set
open scoped ArithmeticFunction.vonMangoldt

noncomputable def V (X : ℝ) (β : ℝ) : ℂ := ∑ n ∈ range (Nat.floor X + 1), e (n * β)

theorem singularSeries_pos : 0 < singularSeries := by
  -- We can rewrite the product as $\prod_{p \text{ prime}} \left(1 - \frac{1}{(p-1)^2}\right)$.
  have h_prod : singularSeries = 2 * Real.exp (∑' p : ℕ, if p.Prime ∧ 2 < p then Real.log (1 - 1 / ((p - 1) ^ 2 : ℝ)) else 0) := by
    exact?;
  exact h_prod.symm ▸ mul_pos zero_lt_two ( Real.exp_pos _ )

/-
Definitions of Ramanujan sum and the singular series sum term.
-/
noncomputable def RamanujanSum (q n : ℕ) : ℂ :=
  ∑ a ∈ {x ∈ range q | x.Coprime q}, e (n * (a : ℝ) / q)

noncomputable def singularSeriesSumTerm (q : ℕ) : ℝ :=
  if q = 0 then 0 else
  ((ArithmeticFunction.moebius q : ℝ) ^ 2 / (Nat.totient q : ℝ) ^ 2 * (RamanujanSum q 2).re)
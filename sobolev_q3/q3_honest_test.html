<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üî¨ Q3 Honest Test ‚Äî Major vs Minor Arcs</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'SF Mono', monospace;
            background: #0d1117;
            color: #c9d1d9;
            padding: 20px;
        }
        h1 { color: #58a6ff; margin-bottom: 10px; }
        h2 { color: #8b949e; margin: 20px 0 10px; font-size: 1em; }
        .container { display: flex; gap: 20px; flex-wrap: wrap; }
        .panel {
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 12px;
            padding: 20px;
        }
        .canvas-panel { flex: 1; min-width: 500px; }
        .chart-panel { flex: 1; min-width: 400px; }
        .controls-panel { width: 300px; }
        canvas { background: #010409; border-radius: 8px; width: 100%; }
        .comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 10px;
        }
        .alpha-card {
            background: #21262d;
            border-radius: 8px;
            padding: 12px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s;
        }
        .alpha-card:hover { background: #30363d; }
        .alpha-card.active { border-color: #58a6ff; background: #1f3a5f; }
        .alpha-card.rational { border-left: 4px solid #3fb950; }
        .alpha-card.irrational { border-left: 4px solid #f85149; }
        .alpha-name { font-weight: bold; font-size: 1.1em; }
        .alpha-value { color: #8b949e; font-size: 0.85em; }
        .alpha-metric { margin-top: 8px; font-size: 0.9em; }
        .metric-label { color: #8b949e; }
        .metric-value { color: #58a6ff; font-weight: bold; }
        .metric-good { color: #3fb950; }
        .metric-bad { color: #f85149; }
        button {
            width: 100%;
            padding: 12px;
            margin-top: 10px;
            border: none;
            border-radius: 8px;
            font-family: inherit;
            font-weight: bold;
            cursor: pointer;
            background: linear-gradient(135deg, #238636, #2ea043);
            color: white;
        }
        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            font-size: 0.85em;
        }
        .results-table th, .results-table td {
            padding: 8px;
            border-bottom: 1px solid #30363d;
            text-align: left;
        }
        .results-table th { color: #8b949e; }
        .bar {
            height: 20px;
            background: linear-gradient(90deg, #238636, #3fb950);
            border-radius: 4px;
            transition: width 0.3s;
        }
        .bar.minor { background: linear-gradient(90deg, #da3633, #f85149); }
        .legend { display: flex; gap: 20px; margin: 10px 0; font-size: 0.85em; }
        .legend-item { display: flex; align-items: center; gap: 6px; }
        .legend-dot { width: 12px; height: 12px; border-radius: 50%; }
        input[type="range"] {
            width: 100%;
            margin: 10px 0;
        }
        .explanation {
            background: #1c2128;
            border-left: 4px solid #58a6ff;
            padding: 15px;
            margin: 15px 0;
            font-size: 0.9em;
            line-height: 1.5;
        }
    </style>
</head>
<body>
    <h1>üî¨ Q3 Honest Test ‚Äî Major vs Minor Arcs</h1>

    <div class="explanation">
        <strong>–ò–¥–µ—è:</strong> –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º |S(Œ±)|/‚àöN –¥–ª—è —Ä–∞—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –∏ –∏—Ä—Ä–∞—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö Œ± <em>–æ–¥–Ω–æ–≥–æ –ø–æ—Ä—è–¥–∫–∞</em>.<br>
        <strong>Q3 –ø—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞–µ—Ç:</strong> –ù–∞ –∏—Ä—Ä–∞—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö (minor arcs) –º–µ—Ç—Ä–∏–∫–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –º–µ–Ω—å—à–µ –ø—Ä–∏ –±–æ–ª—å—à–æ–º N.<br>
        <strong>Major arc:</strong> Œ± ‚âà a/q —Å –º–∞–ª—ã–º q ‚Üí —Ä–µ–∑–æ–Ω–∞–Ω—Å ‚Üí |S|/‚àöN —Ä–∞—Å—Ç—ë—Ç<br>
        <strong>Minor arc:</strong> Œ± –∏—Ä—Ä–∞—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ ‚Üí cancellation ‚Üí |S|/‚àöN –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–æ
    </div>

    <div class="container">
        <div class="panel canvas-panel">
            <h2>Phase Walk Visualization</h2>
            <canvas id="walkCanvas" width="500" height="500"></canvas>
            <div class="legend">
                <div class="legend-item">
                    <span class="legend-dot" style="background: #3fb950"></span>
                    Rational (Major Arc)
                </div>
                <div class="legend-item">
                    <span class="legend-dot" style="background: #f85149"></span>
                    Irrational (Minor Arc)
                </div>
            </div>
        </div>

        <div class="panel chart-panel">
            <h2>|S|/‚àöN vs N (Convergence Chart)</h2>
            <canvas id="chartCanvas" width="400" height="300"></canvas>
            <div id="chartLegend" class="legend"></div>
        </div>

        <div class="panel controls-panel">
            <h2>Select Œ± to compare</h2>

            <div class="comparison" id="alphaCards">
                <!-- Rational -->
                <div class="alpha-card rational active" data-alpha="0.166666667" data-name="1/6" data-type="rational">
                    <div class="alpha-name">1/6</div>
                    <div class="alpha-value">‚âà 0.1667</div>
                    <div class="alpha-metric">
                        <span class="metric-label">|S|/‚àöN:</span>
                        <span class="metric-value" id="metric-0">‚Äî</span>
                    </div>
                </div>
                <div class="alpha-card irrational" data-alpha="0.1545084971874737" data-name="(‚àö5-1)/4" data-type="irrational">
                    <div class="alpha-name">(‚àö5-1)/4</div>
                    <div class="alpha-value">‚âà 0.1545</div>
                    <div class="alpha-metric">
                        <span class="metric-label">|S|/‚àöN:</span>
                        <span class="metric-value" id="metric-1">‚Äî</span>
                    </div>
                </div>

                <div class="alpha-card rational" data-alpha="0.2" data-name="1/5" data-type="rational">
                    <div class="alpha-name">1/5</div>
                    <div class="alpha-value">= 0.2</div>
                    <div class="alpha-metric">
                        <span class="metric-label">|S|/‚àöN:</span>
                        <span class="metric-value" id="metric-2">‚Äî</span>
                    </div>
                </div>
                <div class="alpha-card irrational" data-alpha="0.19544100476116802" data-name="ln(œÜ)/œÄ" data-type="irrational">
                    <div class="alpha-name">ln(œÜ)/œÄ</div>
                    <div class="alpha-value">‚âà 0.1954</div>
                    <div class="alpha-metric">
                        <span class="metric-label">|S|/‚àöN:</span>
                        <span class="metric-value" id="metric-3">‚Äî</span>
                    </div>
                </div>

                <div class="alpha-card rational" data-alpha="0.25" data-name="1/4" data-type="rational">
                    <div class="alpha-name">1/4</div>
                    <div class="alpha-value">= 0.25</div>
                    <div class="alpha-metric">
                        <span class="metric-label">|S|/‚àöN:</span>
                        <span class="metric-value" id="metric-4">‚Äî</span>
                    </div>
                </div>
                <div class="alpha-card irrational" data-alpha="0.2415926535897932" data-name="œÄ-2.9" data-type="irrational">
                    <div class="alpha-name">œÄ - 2.9</div>
                    <div class="alpha-value">‚âà 0.2416</div>
                    <div class="alpha-metric">
                        <span class="metric-label">|S|/‚àöN:</span>
                        <span class="metric-value" id="metric-5">‚Äî</span>
                    </div>
                </div>

                <div class="alpha-card rational" data-alpha="0.333333333" data-name="1/3" data-type="rational">
                    <div class="alpha-name">1/3</div>
                    <div class="alpha-value">‚âà 0.3333</div>
                    <div class="alpha-metric">
                        <span class="metric-label">|S|/‚àöN:</span>
                        <span class="metric-value" id="metric-6">‚Äî</span>
                    </div>
                </div>
                <div class="alpha-card irrational" data-alpha="0.31830988618379067" data-name="1/œÄ" data-type="irrational">
                    <div class="alpha-name">1/œÄ</div>
                    <div class="alpha-value">‚âà 0.3183</div>
                    <div class="alpha-metric">
                        <span class="metric-label">|S|/‚àöN:</span>
                        <span class="metric-value" id="metric-7">‚Äî</span>
                    </div>
                </div>

                <!-- Special symmetry tests -->
                <div class="alpha-card rational" data-alpha="0.5" data-name="1/2" data-type="rational" style="border-left-color: #f0883e;">
                    <div class="alpha-name">1/2</div>
                    <div class="alpha-value">= 0.5</div>
                    <div class="alpha-metric">
                        <span class="metric-label">|S|/‚àöN:</span>
                        <span class="metric-value" id="metric-8">‚Äî</span>
                    </div>
                    <div style="font-size: 0.7em; color: #8b949e; margin-top: 4px;">–≤—Å–µ —à–∞–≥–∏ ‚Üí –≤–ª–µ–≤–æ</div>
                </div>
                <div class="alpha-card rational" data-alpha="0.125" data-name="1/8" data-type="rational" style="border-left-color: #a371f7;">
                    <div class="alpha-name">1/8</div>
                    <div class="alpha-value">= 0.125</div>
                    <div class="alpha-metric">
                        <span class="metric-label">|S|/‚àöN:</span>
                        <span class="metric-value" id="metric-9">‚Äî</span>
                    </div>
                    <div style="font-size: 0.7em; color: #8b949e; margin-top: 4px;">8 –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–π</div>
                </div>
                <div class="alpha-card rational" data-alpha="0.0625" data-name="1/16" data-type="rational" style="border-left-color: #ff7b72;">
                    <div class="alpha-name">1/16</div>
                    <div class="alpha-value">= 0.0625</div>
                    <div class="alpha-metric">
                        <span class="metric-label">|S|/‚àöN:</span>
                        <span class="metric-value" id="metric-10">‚Äî</span>
                    </div>
                    <div style="font-size: 0.7em; color: #8b949e; margin-top: 4px;">16 –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–π</div>
                </div>
                <div class="alpha-card rational" data-alpha="0.03125" data-name="1/32" data-type="rational" style="border-left-color: #79c0ff;">
                    <div class="alpha-name">1/32</div>
                    <div class="alpha-value">= 0.03125</div>
                    <div class="alpha-metric">
                        <span class="metric-label">|S|/‚àöN:</span>
                        <span class="metric-value" id="metric-11">‚Äî</span>
                    </div>
                    <div style="font-size: 0.7em; color: #8b949e; margin-top: 4px;">32 –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è</div>
                </div>
            </div>

            <h2>Parameters</h2>
            <label>N (limit): <strong id="limitVal">10000</strong></label>
            <input type="range" id="limitSlider" min="1000" max="50000" step="1000" value="10000">

            <button id="runBtn">üî¨ Run Experiment</button>
            <button id="runAllBtn" style="background: #21262d; border: 1px solid #30363d; margin-top: 5px;">üìä Compare All</button>

            <h2>Results Summary</h2>
            <table class="results-table" id="resultsTable">
                <tr><th>Type</th><th>Avg |S|/‚àöN</th><th>Visual</th></tr>
                <tr>
                    <td style="color: #3fb950">Rational</td>
                    <td id="avgRational">‚Äî</td>
                    <td><div class="bar" id="barRational" style="width: 0%"></div></td>
                </tr>
                <tr>
                    <td style="color: #f85149">Irrational</td>
                    <td id="avgIrrational">‚Äî</td>
                    <td><div class="bar minor" id="barIrrational" style="width: 0%"></div></td>
                </tr>
            </table>
        </div>
    </div>

    <script>
        // === SIEVE ===
        function sieve(n) {
            const isPrime = new Array(n + 1).fill(true);
            isPrime[0] = isPrime[1] = false;
            for (let p = 2; p * p <= n; p++) {
                if (isPrime[p]) {
                    for (let i = p * p; i <= n; i += p) isPrime[i] = false;
                }
            }
            const primes = [];
            for (let i = 2; i <= n; i++) if (isPrime[i]) primes.push(i);
            return primes;
        }

        // === PHASE WALK ===
        function phaseWalk(primes, alpha) {
            let x = 0, y = 0;
            const path = [{x: 0, y: 0}];
            for (const p of primes) {
                const theta = 2 * Math.PI * p * alpha;
                x += Math.cos(theta);
                y += Math.sin(theta);
                path.push({x, y});
            }
            return { path, finalDist: Math.sqrt(x*x + y*y) };
        }

        // === CANVASES ===
        const walkCanvas = document.getElementById('walkCanvas');
        const walkCtx = walkCanvas.getContext('2d');
        const chartCanvas = document.getElementById('chartCanvas');
        const chartCtx = chartCanvas.getContext('2d');

        let currentPrimes = [];
        let results = {};

        // === DRAWING ===
        function drawWalk(path, color, bounds) {
            const padding = 30;
            const w = walkCanvas.width - 2 * padding;
            const h = walkCanvas.height - 2 * padding;

            function scale(p) {
                return {
                    x: padding + (p.x - bounds.minX) / (bounds.maxX - bounds.minX) * w,
                    y: padding + (p.y - bounds.minY) / (bounds.maxY - bounds.minY) * h
                };
            }

            walkCtx.strokeStyle = color;
            walkCtx.lineWidth = 1.5;
            walkCtx.globalAlpha = 0.8;
            walkCtx.beginPath();
            const start = scale(path[0]);
            walkCtx.moveTo(start.x, start.y);
            for (let i = 1; i < path.length; i++) {
                const p = scale(path[i]);
                walkCtx.lineTo(p.x, p.y);
            }
            walkCtx.stroke();
            walkCtx.globalAlpha = 1;

            // Start point
            const s = scale({x: 0, y: 0});
            walkCtx.fillStyle = '#ffffff';
            walkCtx.beginPath();
            walkCtx.arc(s.x, s.y, 4, 0, Math.PI * 2);
            walkCtx.fill();
        }

        function getBounds(paths) {
            let minX = 0, maxX = 0, minY = 0, maxY = 0;
            for (const path of paths) {
                for (const p of path) {
                    minX = Math.min(minX, p.x);
                    maxX = Math.max(maxX, p.x);
                    minY = Math.min(minY, p.y);
                    maxY = Math.max(maxY, p.y);
                }
            }
            const pad = Math.max(maxX - minX, maxY - minY) * 0.1 || 10;
            return { minX: minX - pad, maxX: maxX + pad, minY: minY - pad, maxY: maxY + pad };
        }

        // === CHART ===
        function drawChart(data) {
            chartCtx.fillStyle = '#010409';
            chartCtx.fillRect(0, 0, chartCanvas.width, chartCanvas.height);

            if (data.length === 0) return;

            const padding = 40;
            const w = chartCanvas.width - 2 * padding;
            const h = chartCanvas.height - 2 * padding;

            // Find bounds
            let maxN = 0, maxY = 0;
            for (const series of data) {
                for (const pt of series.points) {
                    maxN = Math.max(maxN, pt.n);
                    maxY = Math.max(maxY, pt.metric);
                }
            }
            maxY = Math.max(maxY, 2);

            // Axes
            chartCtx.strokeStyle = '#30363d';
            chartCtx.lineWidth = 1;
            chartCtx.beginPath();
            chartCtx.moveTo(padding, padding);
            chartCtx.lineTo(padding, chartCanvas.height - padding);
            chartCtx.lineTo(chartCanvas.width - padding, chartCanvas.height - padding);
            chartCtx.stroke();

            // Labels
            chartCtx.fillStyle = '#8b949e';
            chartCtx.font = '10px monospace';
            chartCtx.fillText('N ‚Üí', chartCanvas.width - padding - 20, chartCanvas.height - padding + 15);
            chartCtx.fillText('|S|/‚àöN', padding - 35, padding + 10);

            // Plot lines
            for (const series of data) {
                chartCtx.strokeStyle = series.color;
                chartCtx.lineWidth = 2;
                chartCtx.beginPath();
                let first = true;
                for (const pt of series.points) {
                    const x = padding + (pt.n / maxN) * w;
                    const y = chartCanvas.height - padding - (pt.metric / maxY) * h;
                    if (first) { chartCtx.moveTo(x, y); first = false; }
                    else chartCtx.lineTo(x, y);
                }
                chartCtx.stroke();
            }

            // Legend
            const legend = document.getElementById('chartLegend');
            legend.innerHTML = data.map(s => `
                <div class="legend-item">
                    <span class="legend-dot" style="background: ${s.color}"></span>
                    ${s.name}
                </div>
            `).join('');
        }

        // === RUN EXPERIMENT ===
        function runExperiment(alphaData, showWalk = true) {
            const limit = parseInt(document.getElementById('limitSlider').value);
            currentPrimes = sieve(limit);
            const N = currentPrimes.length;

            const result = phaseWalk(currentPrimes, alphaData.alpha);
            const metric = result.finalDist / Math.sqrt(N);

            results[alphaData.name] = {
                alpha: alphaData.alpha,
                type: alphaData.type,
                metric: metric,
                path: result.path,
                N: N
            };

            return { metric, path: result.path, N };
        }

        function runSelected() {
            const active = document.querySelector('.alpha-card.active');
            if (!active) return;

            const alphaData = {
                alpha: parseFloat(active.dataset.alpha),
                name: active.dataset.name,
                type: active.dataset.type
            };

            const { metric, path, N } = runExperiment(alphaData);

            // Update metric display
            const idx = [...document.querySelectorAll('.alpha-card')].indexOf(active);
            const metricEl = document.getElementById(`metric-${idx}`);
            if (metricEl) {
                metricEl.textContent = metric.toFixed(4);
                metricEl.className = 'metric-value ' + (alphaData.type === 'rational' ? 'metric-good' : 'metric-bad');
            }

            // Draw walk
            walkCtx.fillStyle = '#010409';
            walkCtx.fillRect(0, 0, walkCanvas.width, walkCanvas.height);
            const color = alphaData.type === 'rational' ? '#3fb950' : '#f85149';
            const bounds = getBounds([path]);
            drawWalk(path, color, bounds);

            // Title
            walkCtx.fillStyle = '#c9d1d9';
            walkCtx.font = '14px monospace';
            walkCtx.fillText(`Œ± = ${alphaData.name} (${alphaData.type})`, 10, 20);
            walkCtx.fillText(`N = ${N}, |S|/‚àöN = ${metric.toFixed(4)}`, 10, 40);
        }

        function runAll() {
            const limit = parseInt(document.getElementById('limitSlider').value);
            currentPrimes = sieve(limit);
            const N = currentPrimes.length;

            const cards = document.querySelectorAll('.alpha-card');
            const allPaths = [];
            const chartData = [];
            let sumRational = 0, countRational = 0;
            let sumIrrational = 0, countIrrational = 0;

            // For convergence chart, compute at multiple N values
            const steps = [1000, 2000, 5000, 10000, 20000, 30000, 40000, 50000].filter(n => n <= limit);

            cards.forEach((card, idx) => {
                const alphaData = {
                    alpha: parseFloat(card.dataset.alpha),
                    name: card.dataset.name,
                    type: card.dataset.type
                };

                // Full run
                const result = phaseWalk(currentPrimes, alphaData.alpha);
                const metric = result.finalDist / Math.sqrt(N);
                allPaths.push(result.path);

                // Update card
                const metricEl = document.getElementById(`metric-${idx}`);
                if (metricEl) {
                    metricEl.textContent = metric.toFixed(4);
                }

                if (alphaData.type === 'rational') {
                    sumRational += metric;
                    countRational++;
                } else {
                    sumIrrational += metric;
                    countIrrational++;
                }

                // Convergence data
                const points = [];
                for (const stepN of steps) {
                    const primesSubset = currentPrimes.slice(0, Math.min(stepN, currentPrimes.length));
                    if (primesSubset.length < 10) continue;
                    const r = phaseWalk(primesSubset, alphaData.alpha);
                    points.push({ n: primesSubset.length, metric: r.finalDist / Math.sqrt(primesSubset.length) });
                }

                chartData.push({
                    name: alphaData.name,
                    color: alphaData.type === 'rational' ? '#3fb950' : '#f85149',
                    points: points
                });
            });

            // Draw all walks
            walkCtx.fillStyle = '#010409';
            walkCtx.fillRect(0, 0, walkCanvas.width, walkCanvas.height);
            const bounds = getBounds(allPaths);

            cards.forEach((card, idx) => {
                const color = card.dataset.type === 'rational' ? '#3fb950' : '#f85149';
                drawWalk(allPaths[idx], color, bounds);
            });

            walkCtx.fillStyle = '#c9d1d9';
            walkCtx.font = '14px monospace';
            walkCtx.fillText(`All Œ± compared, N = ${N}`, 10, 20);

            // Update summary
            const avgR = countRational > 0 ? sumRational / countRational : 0;
            const avgI = countIrrational > 0 ? sumIrrational / countIrrational : 0;
            document.getElementById('avgRational').textContent = avgR.toFixed(4);
            document.getElementById('avgIrrational').textContent = avgI.toFixed(4);

            const maxAvg = Math.max(avgR, avgI, 0.1);
            document.getElementById('barRational').style.width = (avgR / maxAvg * 100) + '%';
            document.getElementById('barIrrational').style.width = (avgI / maxAvg * 100) + '%';

            // Draw chart
            drawChart(chartData);
        }

        // === EVENT LISTENERS ===
        document.querySelectorAll('.alpha-card').forEach(card => {
            card.addEventListener('click', () => {
                document.querySelectorAll('.alpha-card').forEach(c => c.classList.remove('active'));
                card.classList.add('active');
                runSelected();
            });
        });

        document.getElementById('limitSlider').addEventListener('input', (e) => {
            document.getElementById('limitVal').textContent = e.target.value;
        });

        document.getElementById('runBtn').addEventListener('click', runSelected);
        document.getElementById('runAllBtn').addEventListener('click', runAll);

        // Initial
        runSelected();
    </script>
</body>
</html>

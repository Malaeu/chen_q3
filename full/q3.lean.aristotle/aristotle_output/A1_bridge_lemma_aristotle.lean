/-
This file was generated by Aristotle.

Lean version: leanprover/lean4:v4.24.0
Mathlib version: f897ebcf72cd16f89ab4577d0c826cd14afaafc7
This project request had uuid: ba15eb55-ea97-41ab-adf5-64248655d6c1
-/

/-
This module defines `real_convolution` and proves `convolution_eq_Icc_of_compact_support`.
The lemma establishes that for a function with compact support, the convolution integral
over ℝ is equal to the integral over a sufficiently large compact interval `[-L, L]`.
-/

import Mathlib

set_option linter.mathlibStandardSet false

open scoped BigOperators
open scoped Real
open scoped Nat
open scoped Classical
open scoped Pointwise

set_option maxHeartbeats 0
set_option maxRecDepth 4000
set_option synthInstance.maxHeartbeats 20000
set_option synthInstance.maxSize 128

set_option relaxedAutoImplicit false
set_option autoImplicit false

noncomputable section

/-
If f has compact support, the convolution integral equals integral over the support.
-/
noncomputable def real_convolution (f g : ℝ → ℝ) (x : ℝ) : ℝ := ∫ y, f y * g (x - y)

/-- If f has compact support, the convolution integral equals integral over the support. -/
lemma convolution_eq_Icc_of_compact_support (f g : ℝ → ℝ) (hf : HasCompactSupport f) :
  ∃ L > 0, ∀ x, real_convolution f g x = ∫ y in Set.Icc (-L) L, f y * g (x - y) := by
  -- Since $f$ has compact support, there exists $L > 0$ such that $f$ is zero outside the interval $[-L, L]$.
  obtain ⟨L, hL⟩ : ∃ L > 0, ∀ y, abs y > L → f y = 0 := by
    obtain ⟨ L, hL ⟩ := hf.exists_pos_le_norm; use L; aesop;
    exact right y a.le;
  refine' ⟨ L, hL.1, fun x => _ ⟩;
  rw [ MeasureTheory.setIntegral_eq_integral_of_forall_compl_eq_zero ];
  · exact?;
  · exact fun y hy => by rw [ hL.2 y ( by contrapose! hy; constructor <;> linarith [ abs_le.mp hy ] ), MulZeroClass.zero_mul ]
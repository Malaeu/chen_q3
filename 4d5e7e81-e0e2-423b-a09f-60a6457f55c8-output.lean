/-
This file was generated by Aristotle.

Lean version: leanprover/lean4:v4.24.0
Mathlib version: f897ebcf72cd16f89ab4577d0c826cd14afaafc7
This project request had uuid: 4d5e7e81-e0e2-423b-a09f-60a6457f55c8
-/

/-
We define the Fejér kernel, Heat kernel, and the space W_K of continuous, even, non-negative functions supported on [-K, K]. We also define the set of atoms and the cone generated by them (AtomCone_K). Finally, we formalize the statement of the A1' Density Theorem as a proposition `A1_Density_Theorem_Statement`, asserting that AtomCone_K is dense in W_K in the uniform norm. Due to persistent technical issues with the ATP (SOCKS server failure), we were unable to process the proof or declare the theorem as a lemma with `sorry`. However, all necessary definitions and the theorem statement have been successfully formalized.
-/

import Mathlib

set_option linter.mathlibStandardSet false

open scoped BigOperators
open scoped Real
open scoped Nat
open scoped Classical
open scoped Pointwise

set_option maxHeartbeats 0
set_option maxRecDepth 4000
set_option synthInstance.maxHeartbeats 20000
set_option synthInstance.maxSize 128

set_option relaxedAutoImplicit false
set_option autoImplicit false

noncomputable section

/-
Definition of Fejér kernel and Heat kernel.
-/
noncomputable def FejerKernel (B : ℝ) (x : ℝ) : ℝ := max 0 (1 - |x| / B)

noncomputable def HeatKernel (t : ℝ) (x : ℝ) : ℝ := (4 * Real.pi * t) ^ (-(1:ℝ)/2) * Real.exp (-x^2 / (4 * t))

/-
Definition of W_K and Atom.
-/
def W_K (K : ℝ) : Set (ℝ → ℝ) :=
  {Φ | ContinuousOn Φ (Set.Icc (-K) K) ∧ Function.support Φ ⊆ Set.Icc (-K) K ∧ Even Φ ∧ ∀ x, 0 ≤ Φ x}

noncomputable def Atom (B t τ : ℝ) (x : ℝ) : ℝ :=
  FejerKernel B (x - τ) * HeatKernel t (x - τ) + FejerKernel B (x + τ) * HeatKernel t (x + τ)

/-
Definition of AtomSet.
-/
def AtomSet (K : ℝ) : Set (ℝ → ℝ) :=
  {g | ∃ B > 0, ∃ t > 0, ∃ τ ∈ Set.Icc (-K) K, g = Atom B t τ}

/-
Definition of AtomCone_K.
-/
def AtomCone_K (K : ℝ) : Set (ℝ → ℝ) :=
  Convex.toCone (convexHull ℝ (AtomSet K)) (convex_convexHull ℝ (AtomSet K))

/-
Checking connection.
-/
lemma check_connection : 1 = 1 := rfl

/-
Definition of the set of differences between Φ and g on [-K, K].
-/
def diff_set (Φ : ℝ → ℝ) (g : ℝ → ℝ) (K : ℝ) : Set ℝ :=
  (fun x ↦ |Φ x - g x|) '' Set.Icc (-K) K

/-
Definition of density in W_K.
-/
def IsDenseInWK (K : ℝ) : Prop :=
  ∀ Φ ∈ W_K K, ∀ ε > 0, ∃ g ∈ AtomCone_K K, sSup (diff_set Φ g K) < ε

/-
Testing connection again.
-/
lemma test_connection_2 : True := trivial

/-
Testing connection again.
-/
lemma test_connection_3 : True := trivial

/-
Testing reference to W_K.
-/
lemma test_WK_ref (K : ℝ) (h : W_K K = W_K K) : True := trivial

/-
Definition of convolution for real-valued functions.
-/
noncomputable def real_convolution (f g : ℝ → ℝ) (x : ℝ) : ℝ := ∫ t, f t * g (x - t)

/-
Definition of Riemann sum approximation for convolution.
-/
noncomputable def RiemannSumApprox (g : ℝ → ℝ) (kernel : ℝ → ℝ) (K : ℝ) (N : ℕ) (x : ℝ) : ℝ :=
  let Δτ := 2 * K / N
  ∑ j ∈ Finset.range N, g (-K + j * Δτ) * kernel (x - (-K + j * Δτ)) * Δτ

/-
Proposition representing the A1 Density Theorem.
-/
def A1_density_WK_statement_prop (K : ℝ) : Prop :=
  K > 0 → IsDenseInWK K

/-
Checking connection.
-/
lemma check_connection_4 : True := trivial

/-
Testing reference to W_K in a theorem.
-/
theorem test_WK (K : ℝ) (f : ℝ → ℝ) (h : f ∈ W_K K) : True := trivial

/-
Testing reference to AtomCone_K.
-/
theorem test_AtomCone (K : ℝ) (f : ℝ → ℝ) (h : f ∈ AtomCone_K K) : True := trivial

/-
Testing convolution and heat kernel in a lemma.
-/
lemma test_convolution_heat (K : ℝ) (f : ℝ → ℝ) : real_convolution f (HeatKernel 1) 0 = real_convolution f (HeatKernel 1) 0 := rfl

/-
Proposition: Fejér kernel approximates 1 on compacts.
-/
def FejerKernel_approx_one_prop (K : ℝ) : Prop :=
  K > 0 → ∀ ε > 0, ∃ B > 0, ∀ x ∈ Set.Icc (-K) K, |FejerKernel B x - 1| < ε

/-
Proposition: Heat kernel is a positive approximate identity.
-/
def HeatKernel_approx_identity_prop (K : ℝ) : Prop :=
  K > 0 → ∀ f ∈ W_K K, ∀ ε > 0, ∃ t > 0, ∀ x ∈ Set.Icc (-K) K, |real_convolution f (HeatKernel t) x - f x| < ε

/-
Proposition: Riemann sums approximate the convolution.
-/
def RiemannSum_approx_prop (K : ℝ) : Prop :=
  K > 0 → ∀ g ∈ W_K K, ∀ t > 0, ∀ ε > 0, ∃ N : ℕ, ∀ x ∈ Set.Icc (-K) K,
    |RiemannSumApprox g (HeatKernel t) K N x - real_convolution g (HeatKernel t) x| < ε

/-
Proposition: Fejér truncation approximates the convolution.
-/
def FejerTruncation_prop (K : ℝ) : Prop :=
  K > 0 → ∀ g ∈ W_K K, ∀ t > 0, ∀ ε > 0, ∃ h ∈ AtomCone_K K,
    ∀ x ∈ Set.Icc (-K) K, |h x - real_convolution g (HeatKernel t) x| < ε

/-
Testing reference to IsDenseInWK.
-/
theorem test_IsDenseInWK (K : ℝ) (h : IsDenseInWK K) : True := trivial

/-
The statement of the A1 Density Theorem.
-/
def A1_Density_Theorem_Statement : Prop := ∀ K : ℝ, K > 0 → IsDenseInWK K

/-
The Fejér kernel is non-negative.
-/
theorem FejerKernel_nonneg (B : ℝ) (x : ℝ) : 0 ≤ FejerKernel B x := le_max_left 0 (1 - |x| / B)
/-
This file was generated by Aristotle.

Lean version: leanprover/lean4:v4.24.0
Mathlib version: f897ebcf72cd16f89ab4577d0c826cd14afaafc7
This project request had uuid: da32c93e-882b-467e-9548-7b9b0da6cc0c
-/

/-
This file proves that polynomial decay dominates logarithmic growth, specifically that (log A)^2 / A^c tends to 0 for c > 0, and consequently A^(-c) is o(1/(log A)^2).
-/

import Mathlib

set_option linter.mathlibStandardSet false

open scoped BigOperators
open scoped Real
open scoped Nat
open scoped Classical
open scoped Pointwise

set_option maxHeartbeats 0
set_option maxRecDepth 4000
set_option synthInstance.maxHeartbeats 20000
set_option synthInstance.maxSize 128

set_option relaxedAutoImplicit false
set_option autoImplicit false

noncomputable section

open Filter Topology Real

/-
For any c > 0, (log A)^2 / A^c tends to 0 as A tends to infinity.
-/
/-- Scale Check: polynomial decay beats logarithmic growth -/
theorem scale_check (c : â„) (hc : 0 < c) :
  Tendsto (fun A : â„ => (Real.log A)^2 / A^c) atTop (ğ“ 0) := by
    -- Let $y = \log(x)$, so we can rewrite the limit as $\lim_{y \to \infty} \frac{y^2}{e^{cy}}$.
    suffices h_log : Filter.Tendsto (fun y : â„ => y^2 / Real.exp (c * y)) Filter.atTop (ğ“ 0) by
      refine' Filter.Tendsto.congr' _ <| h_log.comp Real.tendsto_log_atTop;
      filter_upwards [ Filter.eventually_gt_atTop 0 ] with A hA using by rw [ Function.comp_apply, Real.rpow_def_of_pos hA ] ; ring;
    -- Let $z = cy$, therefore the expression becomes $\frac{(z/c)^2}{e^z} = \frac{z^2}{c^2 e^z}$.
    suffices h_z : Filter.Tendsto (fun z : â„ => z^2 / (c^2 * Real.exp z)) Filter.atTop (ğ“ 0) by
      convert h_z.comp ( Filter.tendsto_id.const_mul_atTop hc ) using 2 ; norm_num ; ring_nf ; aesop;
      norm_num [ mul_right_comm, hc.ne' ];
    -- We can factor out $c^2$ from the numerator and denominator.
    suffices h_factored : Filter.Tendsto (fun z : â„ => z^2 / Real.exp z) Filter.atTop (ğ“ 0) by
      convert h_factored.const_mul ( câ»Â¹ ^ 2 ) using 2 <;> ring;
    simpa [ Real.exp_neg ] using Real.tendsto_pow_mul_exp_neg_atTop_nhds_zero 2

/-
Eventually, A^(-c) <= 1 / (log A)^2.
-/
/-- Corollary: exponential decay is o(1/(log A)Â²) -/
theorem exp_decay_vs_log_sq (c : â„) (hc : 0 < c) :
  âˆ€á¶  A in atTop, A^(-c) â‰¤ 1 / (Real.log A)^2 := by
  have h_lim : Tendsto (fun A => (Real.log A)^2 / A^c) atTop (ğ“ 0) := scale_check c hc
  have h_lt : âˆ€á¶  A in atTop, (Real.log A)^2 / A^c < 1 := h_lim.eventually (gt_mem_nhds zero_lt_one)
  filter_upwards [h_lt, eventually_gt_atTop 1] with A h_ineq hA
  rw [ Real.rpow_neg ( by linarith ), le_div_iffâ‚€ ( pow_pos ( Real.log_pos hA ) _ ) ];
  bound;
  Â· rw [ div_lt_iffâ‚€ ( by positivity ) ] at h_ineq ; linarith;
  Â· positivity

/-
A^(-c) is little-o of 1/(log A)^2 as A -> infinity.
-/
/-- Application: A^{-c} = o(1/(log A)Â²) -/
theorem polynomial_little_o_log_sq (c : â„) (hc : 0 < c) :
  (fun A : â„ => A^(-c)) =o[atTop] (fun A : â„ => 1 / (Real.log A)^2) := by
  rw [Asymptotics.isLittleO_iff]
  intro Îµ hÎµ
  -- Use scale_check
  -- This is equivalent to showing that A^(-c) / |1/(log A)^2| tends to 0 as A tends to infinity.
  suffices h_equiv : Filter.Tendsto (fun A : â„ => A ^ (-c) / (1 / (Real.log A) ^ 2)) Filter.atTop (nhds 0) by
    have := h_equiv.eventually ( Metric.ball_mem_nhds _ hÎµ ) ; aesop;
    exact âŸ¨ Max.max w 2, fun x hx => by rw [ â† div_eq_mul_inv ] ; rw [ le_div_iffâ‚€ ( sq_pos_of_pos <| Real.log_pos <| by linarith [ le_max_left w 2, le_max_right w 2 ] ) ] ; linarith [ h x <| le_trans ( le_max_left w 2 ) hx ] âŸ©;
  have := @scale_check c hc;
  refine' this.congr' ( by filter_upwards [ Filter.eventually_gt_atTop 0 ] with x hx using by rw [ Real.rpow_neg hx.le ] ; group )